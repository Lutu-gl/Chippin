<div *ngIf="error" class="alert alert-danger alert-dismissible fade show" role="alert">
  <strong>Error! </strong> {{ errorMessage }}
  <button type="button" (click)="vanishError()" class="close" data-dismiss="alert" aria-label="Close">
    <span aria-hidden="true">&times;</span>
  </button>
</div>

<div class="pt-5">
  <div class="row">
    <div class="col">
      <h2>Pantry</h2>
    </div>
  </div>
  <div class="row">
    <div class="mt-3">
      <input type="text" id="searchDescription" name="searchDescription"
             class="form-control col-9"
             placeholder="Search for an item"
             [(ngModel)]="searchString"
             (ngModelChange)="searchChanged()"
      >
      <form #form="ngForm" class="row pt-3" (ngSubmit)="onSubmit(form)">
        <div class="col-1">
          <button name="button" type="button" class="btn btn-warning m-2" (click)="markImportant()">
            <i *ngIf="newItem.lowerLimit === null" class="bi bi-star"></i>
            <i *ngIf="newItem.lowerLimit !== null" class="bi bi-star-fill"></i>
          </button>
        </div>
        <div class="col-1 align-content-center">
          <button name="submit" type="submit" class="btn btn-info m-2">
            <i class="bi bi-plus-lg"></i>
          </button>
        </div>
        <div class="col-2 align-content-center">
        </div>
        <div class="col-1">
          <input name="newItemAmount" type="number" class="form-control" id="newItemAmount" placeholder="0"
                 [(ngModel)]="newItem.amount" required min="0">
        </div>
        <div class="col-1">
          <input *ngIf="newItem.lowerLimit !== null" name="newItemAmount" type="number" class="form-control"
                 id="newItemLowerLimit" placeholder="0"
                 [(ngModel)]="newItem.lowerLimit" required min="0">
        </div>
        <div class="col-2">
          <select name="newItemUnit" class="form-select" [(ngModel)]="newItem.unit" required>
            <option *ngFor="let unit of Unit | keyvalue"
                    [selected]="newItem.unit===unit.key">{{ unit.value }}</option>
          </select>
        </div>
        <div class="col">
          <input name="newItemDescription" class="form-control" placeholder="Add a new item"
                 [(ngModel)]="newItem.description" required minlength="2">
        </div>
      </form>
      <table class="table table-hover">
        <thead>
        <tr>
          <th class="col-1"></th>
          <th class="col-1"></th>
          <th class="col-2"></th>
          <th class="col-1">Amount</th>
          <th class="col-1">Min</th>
          <th class="col-2">Unit</th>
          <th>Item</th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let item of items" class="center-td">
          <td>
            <button class="btn btn-danger" *ngIf="item.lowerLimit !== null && item.lowerLimit > item.amount">
              <i class="bi bi-exclamation-triangle"></i>
            </button>
          </td>
          <td class="row">
            <div class="col align-content-center">
              <a class="btn responsive-danger-button m-1"
                 (click)="selectItem(item)"
                 data-bs-toggle="modal"
                 data-bs-target="#confirm-delete-dialog-title"
                 aria-label="Delete item">
                <i class="bi bi-trash"></i>
              </a>
              <a class="btn responsive-warning-button m-1"
                 (click)="selectItem(item); selectEditItem(clone(item))"
                 data-bs-toggle="modal"
                 data-bs-target="#edit-pantry-item-dialog-title"
                 aria-label="Edit item">
                <i class="bi bi-pencil"></i>
              </a>
            </div>
          </td>
          <td>
            <div class="col-8 align-content-center">
              <div class="row">
                <!--small-->
                <a class="btn btn-sm responsive-success-button col m-1"
                   [text]="getUnitStepString(getUnitStep(item, false, true), item.amount)"
                   (click)="changeAmount(item, getUnitStep(item, false, true))"></a>
                <!--large-->
                <a class="btn btn-sm responsive-success-button col m-1"
                   [text]="getUnitStepString(getUnitStep(item, true, true), item.amount)"
                   (click)="changeAmount(item, getUnitStep(item, true, true))"></a>
              </div>
              <div class="row">
                <!--small-->
                <a class="btn btn-sm responsive-danger-button col m-1"
                   [text]="getUnitStepString(getUnitStep(item, false, false), item.amount)"
                   (click)="changeAmount(item, getUnitStep(item, false, false))"></a>
                <!--large-->
                <a class="btn btn-sm responsive-danger-button col m-1"
                   [text]="getUnitStepString(getUnitStep(item, true, false), item.amount)"
                   (click)="changeAmount(item, getUnitStep(item, true, false))"></a>
              </div>
            </div>
          </td>
          <td>
            <input type="number" class="form-control" id="itemAmount"
                   [(ngModel)]="item.amount" disabled>
          </td>
          <td>
            <input *ngIf="item.lowerLimit !== null" type="number" class="form-control" id="lowerLimit"
                   [(ngModel)]="item.lowerLimit" disabled>
            <input *ngIf="item.lowerLimit === null" type="text" class="form-control" id="lowerLimitDisabled"
                   [value]="'-'"
                   disabled>
          </td>
          <td>
            <select class="form-select" [(ngModel)]="item.unit" disabled>
              <option *ngFor="let unit of Unit | keyvalue" [value]="unit.key"
                      [selected]="item.unit===unit.key">{{ unit.value }}</option>
            </select>
          </td>
          <td>
            {{item.description}}
          </td>
        </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<app-confirm-delete-dialog [deleteWhat]="selectedItem?.description"
                           (confirm)="deleteItem(selectedItem.id)"></app-confirm-delete-dialog>
<app-edit-pantry-item-dialog [itemToEdit]="itemToEdit" [items]="items" [itemMergeDto]="mergeItem" [itemToMerge]="clone(itemToEdit)"
                             (confirmEdit)="editItem(); searchChanged()" (confirmMerge)="mergeItems(); searchChanged()"></app-edit-pantry-item-dialog>
