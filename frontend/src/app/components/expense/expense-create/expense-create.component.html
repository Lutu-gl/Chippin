<!-- Modal for delete confirmation -->
<p-dialog
  header="Delete Expense"
  [modal]="true"
  [(visible)]="isDeleteDialogVisible"
  [style]="{ width: '25rem' }"
>
  <span class="p-text-secondary block mb-5">Do you really want to delete this expense?</span>
  <div class="flex justify-content-end gap-2">
    <p-button label="No" severity="secondary" (click)="closeDeleteDialog()" />
    <p-button label="Yes" (click)="deleteExistingExpense()"/>
  </div>
</p-dialog>

<div class="bg-blue-100 p-6 rounded-lg shadow-md w-full max-w-2xl mx-auto space-y-6 mt-2">

  <label *ngIf="expenseIsDeleted()" class="flex items-center text-red-500 font-bold">
    <i class="pi pi-exclamation-triangle mr-2"></i>
    This Expense is marked as deleted!
  </label>

  <label *ngIf="expenseIsArchived()" class="flex items-center text-red-500 font-bold">
    <i class="pi pi-exclamation-triangle mr-2"></i>
    This Expense is marked as archived!
  </label>
  <label *ngIf="expenseIsArchived()" class="block text-sm font-medium text-gray-700">A member of the expense has left the group, thus it is not possible to make changes.</label>

  <!-- Input fields -->
  <div class="space-y-4">
    <!-- Expense name -->
    <div>
      <label class="block text-sm font-medium text-gray-700">Expense Name</label>
      <input type="text" pInputText
        [(ngModel)]="expenseName"
        [readonly]="modeIsInfo()"
      />
    </div>
    <!-- Expense amount -->
    <div>
      <label for="currency-germany" class="block text-sm font-medium text-gray-700">Total Amount (€)</label>
      <p-inputNumber
        [(ngModel)]="expenseAmount"
        (onInput)="expenseAmountChange($event)"
        [readonly]="modeIsInfo()"
        mode="currency"
        inputId="currency-germany"
        currency="EUR"
        locale="de-DE"
        [min]="0.01"
        [max]="9999999.99"
      />
    </div>
    <!-- Expense category -->
    <div>
      <label class="block text-sm font-medium text-gray-700">Category</label>
      <input type="text" pInputText
        *ngIf="modeIsInfo()"
        [(ngModel)]="selectedCategory.name"
        [readonly]="modeIsInfo()" />
      <p-autoComplete
        *ngIf="!modeIsInfo()"
        [(ngModel)]="selectedCategory"
        [dropdown]="true"
        [suggestions]="filteredCategories"
        (completeMethod)="filterCategory($event)"
        [forceSelection]="true"
        field="name"
      />
    </div>
    <!-- Expense payer -->
    <div>
      <label class="block text-sm font-medium text-gray-700">Payer</label>
      <input type="text" pInputText
        *ngIf="modeIsInfo()"
        [(ngModel)]="selectedPayer.name"
        [readonly]="modeIsInfo()" />
      <p-autoComplete
        *ngIf="!modeIsInfo()"
        [(ngModel)]="selectedPayer"
        [dropdown]="true"
        [suggestions]="filteredPayers"
        (completeMethod)="filterPayer($event)"
        [forceSelection]="true"
        field="name"
      />
    </div>
  </div>

  <!-- Mitglieder der Gruppe -->
  <div>
    <div class="text-lg font-bold mb-2">Group Members</div>
    <div class="space-y-4">
      <div *ngFor="let member of members" class="flex justify-between items-center">
        <div class="flex items-center space-x-4">
          <p-checkbox
            [readonly]="modeIsInfo()"
            [(ngModel)]="member.isParticipating"
            (onChange)="expenseAmountChange($event)"
            [binary]="true"
            type="binary"
          />
          <label class="block text-sm font-medium text-gray-700">{{ member.email }}</label>
        </div>
        <p-inputNumber
          [readonly]="modeIsInfo()"
          [(ngModel)]="member.amount"
          mode="currency"
          currency="EUR"
          locale="de-DE"
          [min]="0.01"
          [max]="9999999.99"
          placeholder="Amount (€)"
        />
      </div>
    </div>
  </div>

  <!-- Buttons -->
  <div *ngIf="modeIsCreate() && !expenseIsDeleted() && !expenseIsArchived()" class="flex justify-end">
    <p-button (click)="onSubmit()"> Create Expense</p-button>
  </div>
  <div *ngIf="modeIsEdit() && !expenseIsDeleted() && !expenseIsArchived()" class="flex justify-end gap-2">
<!--    <button (click)="openDeleteDialog()" class="bg-red-500 text-white font-bold py-2 px-4 rounded flex items-center hover:bg-red-600 mr-2">-->
<!--      <i class="pi pi-trash mr-2"></i> Delete Expense-->
<!--    </button>-->
    <p-button
      label="Delete Payment"
      icon="pi pi-trash"
      iconPos="left"
      (click)="openDeleteDialog()"
    ></p-button>

    <p-button
      label="Save Changes"
      icon = "pi pi-check"
      iconPos="left"
      (click)="onSubmit()"
    ></p-button>
  </div>
  <div *ngIf="modeIsInfo() && !expenseIsDeleted() && !expenseIsArchived()" class="flex justify-end gap-2">
<!--    <button (click)="openDeleteDialog()" class="bg-red-500 text-white font-bold py-2 px-4 rounded flex items-center hover:bg-red-600 mr-2">-->
<!--      <i class="pi pi-trash mr-2"></i> Delete Expense-->
<!--    </button>-->
    <p-button
      label="Delete Payment"
      icon="pi pi-trash"
      iconPos="left"
      (click)="openDeleteDialog()"
    ></p-button>

    <p-button
      label="Edit Expense"
      icon="pi pi-pencil"
      iconPos="left"
      (click)="switchToEditMode()"
    ></p-button>
  </div>
  <div *ngIf="expenseIsDeleted() && !expenseIsArchived()" class="flex justify-end">
    <p-button
      label="Recover Expense"
      icon="pi pi-undo"
      iconPos="left"
      (click)="recoverDeletedExpense()"
    ></p-button>
  </div>
</div>
