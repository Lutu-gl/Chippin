<!--Modal to settle debts in the top right corner -->
<p-dialog header="Settle Debt"
          [(visible)]="visibleModalSettleDebts"
          [modal]="true"
          [breakpoints]="{ '1199px': '75vw', '575px': '90vw' }"
          [draggable]="false"
          [resizable]="false"
          [style]="{ width: '40rem'}"
>
  <p-confirmDialog />
  <div *ngIf="getMembersOnlyNegativeDebts().length === 0" class="w-full max-w-md p-4 flex rounded ">
    <p>Perfect! Seems like you do not have open debts</p>
  </div>


  <div *ngIf="getMembersOnlyNegativeDebts().length > 0">
    <br>
    <span class="p-text-secondary block mb-5">Insert a payment to a user</span>
    <label for="debtMemberSelection" class="font-semibold w-6rem">Open Debts</label>

      <div *ngFor="let entry of getMembersOnlyNegativeDebts()" class="flex items-center justify-between p-4 bg-blue-50 rounded-lg shadow">
        <div class="flex items-center space-x-4">
          <div class="bg-gray-300 rounded-full h-10 w-10 flex items-center justify-center text-xl font-bold">{{ entry[0][0] }}</div>
          <div>
            <div class="font-bold">{{ entry[0] }}</div>
          </div>
        </div>
        <div *ngIf="entry[1] < 0" class="text-red-500 font-bold">{{ entry[1] | currency: 'EUR' }}</div>
      </div>

    <br>
    <form #form="ngForm" (ngSubmit)="paymentCreationSave(form)" name="formOfSettleDebt">
    <div class="flex flex-col align-items-center gap-3 mb-3">
      <label for="debtMemberSelection" class="font-semibold w-6rem">To User</label>
      <p-autoComplete
        name="currentlySelected"
        [(ngModel)]="selectedDebtMemberVar"
        [suggestions]="filteredDebtMembers"
        (completeMethod)="filterDebtMembers($event)"
        (onSelect)="selectedDebtMember($event)"
        [dropdown]="true"
        [forceSelection]="debtMembers"
        id = "debtMemberSelection"
        [required]="true"
      />
    </div>
    <div class="flex flex-col align-items-center gap-3 mb-5">
      <label for="amount" class="font-semibold w-6rem">Amount</label>
      <input pInputText placeholder="30"  [(ngModel)]="amountOfSelectedDebtMember" name="amountOfSelectedDebtMember" id="amount" type="number" min="1" max="1000000" class="flex-auto" autocomplete="off" [required]="true" required/>
    </div>
    <br>
    <br>
    <div class="flex justify-content-end gap-2">
      <p-button label="Cancel" severity="secondary" (click)="goBackFromSettleDebts($event)" />
      <p-button label="Save" [disabled]="(!form.valid || !selectedDebtMemberVar)" (click)="paymentCreationSave(form)" />
    </div>
    </form>
  </div>

</p-dialog>

<div>
  <!-- Header part with diagram -->
  <div class="bg-blue-100">
    <div class="p-4 flex">
      <div class="w-2/3 flex justify-center">
        <div class="bg-blue-100 p-4 max-w-3xl mx-auto">
          <div class="flex items-end justify-around">
            <div class="bg-blue-100 p-4 rounded-lg shadow-md w-full max-w-3xl mx-auto">
              <div class="flex items-end justify-around space-x-4">
                <div *ngFor="let entry of membersWithDebtsWithoutEven" class="flex flex-col items-center space-y-2">
                  <div *ngIf="entry[1] > 0" class="bg-blue-300 p-4 rounded-t-lg shadow flex flex-col justify-between" [ngStyle]="{ height: calcChartHeight(entry[1]) }">
                    <span class="font-bold self-end">{{ entry[1] | currency: 'EUR' }}</span>
                  </div>
                  <div *ngIf="entry[1] < 0" class="bg-red-300 p-4 rounded-t-lg shadow flex flex-col justify-between" [ngStyle]="{ height: calcChartHeight(entry[1]) }">
                    <span class="font-bold self-end">{{ entry[1] | currency: 'EUR' }}</span>
                  </div>
                  <div class="mt-2 text-center">
                    <span class="font-bold" style="font-size: xx-small;">{{ entry[0] }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="flex flex-col justify-between items-start ml-4">
        <div class="mb-4">
          <h2 class="text-2xl font-bold">{{ group.groupName }}</h2>
          <div class="text-sm">Transactions: {{ transactions.length }}</div>
          <div class="text-sm">Members: {{ group.members.length }}</div>
          <div class="text-sm">Total spent: €343</div>
        </div>
        <div class="flex space-x-2 mt-4">
          <p-button label="Show charts"></p-button>
          <p-button label="Settle debts" (click) ="showDialogSettleDebts()"></p-button>
          <p-menu #menu [model]="menuitemsButtonMore" [popup]="true" ></p-menu>
          <p-button label="More" icon="pi pi-angle-down" severity="secondary" iconPos="right" (click)="menu.show($event)"></p-button>

        </div>
      </div>
    </div>

    <div class="pt-5 flex justify-center">
      <p-tabMenu
        [model]="tabMenuItems"
        [activeItem]="tabMenuActiveItem"
        (activeItemChange)="onActiveItemChange($event)"
      ></p-tabMenu>
    </div>
  </div>

  <!-- Transactions part -->
  <div *ngIf="isTransactionsSelected()" class="p-4 max-w-lg mx-auto">
    <div class="space-y-4">
      <div *ngFor="let transaction of transactions" class="flex items-center justify-between p-4 bg-blue-50 rounded-lg shadow">
        <div class="flex items-center space-x-4">
          <div>
            <div class="font-normal text-sm">User <b>{{ transaction.userEmail }}</b> {{ transaction.description }}</div>
            <div class="text-xs">{{ transaction.timestamp | date: 'dd.MM.yyyy, HH:mm' }}</div>
          </div>
        </div>
        <div class="bg-gray-300 rounded-full px-2 py-1 text-gray-700 font-normal text-sm">{{ transaction.amount | currency: 'EUR' }}</div>
      </div>
    </div>
  </div>

  <!-- Old Debts tab - Is in reality the payments tab -->
<!--  <div *ngIf="isDebtsSelected()" class="p-4 max-w-2xl mx-auto space-y-4">-->
<!--    <div *ngFor="let payment of payments" class="bg-blue-50 p-6 rounded-lg shadow-md flex justify-between items-center">-->
<!--      <span class="font-bold">{{ payment.userEmail }}</span>-->
<!--      <div class="flex flex-col justify-center align-items-center">-->
<!--        <span class="text-red-500 font-bold">{{ payment.amount | currency: 'EUR' }}</span>-->
<!--        <span class="text-black text-center font-bold">→</span>-->
<!--      </div>-->
<!--      <span class="font-bold">{{ payment.paymentReceiverEmail }}</span>-->
<!--    </div>-->

<!--  </div>-->

    <div *ngIf="isDebtsSelected()" class="p-4 max-w-2xl mx-auto space-y-4">
      <div *ngFor="let payment of payments" class="bg-blue-50 p-6 rounded-lg shadow-md flex justify-between items-center">
        <span class="font-bold">{{ payment.userEmail }}</span>
        <div class="flex flex-col justify-center align-items-center">
          <span class="text-red-500 font-bold">{{ payment.amount | currency: 'EUR' }}</span>
          <span class="text-black text-center font-bold">→</span>
        </div>
        <span class="font-bold">{{ payment.paymentReceiverEmail }}</span>
      </div>

  </div>

  <!-- Members tab -->
  <div *ngIf="isMembersSelected()" class="p-4 max-w-md mx-auto">
<!--    <div class="flex justify-center mb-4">-->
<!--      <button class="bg-blue-200 text-blue-600 font-bold py-2 px-4 rounded-full flex items-center">-->
<!--        <span class="text-xl mr-2">+</span> Add member-->
<!--      </button>-->
<!--    </div>-->
    <div class="space-y-4">
      <div class="flex items-center justify-between p-4 bg-blue-50 rounded-lg shadow">
        <div class="flex items-center space-x-4">
          <div class="bg-gray-300 rounded-full h-10 w-10 flex items-center justify-center text-xl font-bold">{{ debt?.userEmail[0] || "" }}</div>
          <div>
            <div class="font-bold">{{ debt.userEmail }}</div>
          </div>
        </div>
        <div class="bg-gray-300 rounded-full px-2 py-1 text-gray-700 font-bold">You</div>
      </div>

        <div *ngFor="let entry of getMembersWithDebtsSorted()" class="flex items-center justify-between p-4 bg-blue-50 rounded-lg shadow">
          <div class="flex items-center space-x-4">
            <div class="bg-gray-300 rounded-full h-10 w-10 flex items-center justify-center text-xl font-bold">{{ entry[0][0] }}</div>
            <div>
              <div class="font-bold">{{ entry[0] }}</div>
            </div>
          </div>
          <div *ngIf="entry[1] > 0" class="text-green-500 font-bold">{{ entry[1] | currency: 'EUR' }}</div>
          <div *ngIf="entry[1] < 0" class="text-red-500 font-bold">{{ entry[1] | currency: 'EUR' }}</div>
          <div *ngIf="entry[1] === 0" class="bg-gray-300 rounded-full px-2 py-1 text-gray-700 font-bold">even</div>
        </div>
    </div>
  </div>


  <app-pantry *ngIf="isPantrySelected()"></app-pantry>
  <div *ngIf="isShoppingListsSelected()">Shopping lists works</div>

</div>




<!-- <h1 class="display-1">{{ group?.groupName }}</h1>
<div *ngIf="group">
  <div class="d-flex justify-content-between">
    <h3 class="members">Members</h3>
    <button type="button"
            class="btn btn-secondary"
            [routerLink]="['edit']">
      <i class="bi bi-pencil"></i>
      Edit
    </button>
  </div>
  <div class="member-list">
    <div *ngFor="let member of getSortedMembers()" class="member-list-item">
      {{ member.email }}
    </div>
  </div>
  <br>
  <div class="h-52 overflow-y-auto overflow-x-hidden">
    <ng-container *ngFor="let userEmail of objectKeys(debt.membersDebts)">
      <div *ngIf="debt.membersDebts[userEmail] >= 0.01"
           class="debt-list-item positive-debt d-flex align-items-center justify-content-between">
        <span>{{ userEmail }} owes you {{ debt.membersDebts[userEmail] | number:'1.2-2' }} €</span>
        <button type="button" class="btn btn-secondary me-2 small-button invisible-button">Settle debts</button>
      </div>
      <div *ngIf="debt.membersDebts[userEmail] <= -0.01"
           class="debt-list-item negative-debt d-flex align-items-center justify-content-between">
        <span>You owe {{ userEmail }} {{ -debt.membersDebts[userEmail] | number:'1.2-2' }} €</span>
        <button type="button" class="btn btn-secondary me-2 small-button" [routerLink]="['payment', 'create', userEmail, parseFloat((-debt.membersDebts[userEmail]).toFixed(2))]">Settle debts</button>
      </div>
    </ng-container>
  </div>

  <br>

  <div class="">
    <app-expense-list [groupId]="group.id" [activityType]="ActivityType.expense"></app-expense-list>
  </div>
  <br>
  <div class="">
    <app-expense-list [groupId]="group.id" [activityType]="ActivityType.payment"></app-expense-list>
  </div>
  <br>



  <div class="">
    <app-budget-list [groupId]="group.id"></app-budget-list>
  </div>


  <div class="">
    <button type="button"
            class="btn btn-secondary"
            [routerLink]="['pantry']"
    >
      Pantry
    </button>
  </div>
  <div class="">
    <app-shopping-list [groupId]="group.id"></app-shopping-list>
  </div>



<div class="pt-5">
  <div class="row">
    <div class="col">

    </div>
  </div>
</div>
</div> -->
